description: >
  Install a custom version of the Yarn package manager

parameters:
  windows:
    type: boolean
    default: false
    description: >
      whether the build is running on windows or not
  version:
    type: string
    default: ""
    description: >
      Pick a version of Yarn to install (if no version is specified,
      the latest stable version will be installed):
      https://github.com/yarnpkg/yarn/releases

steps:
  - unless:
      condition: << parameters.windows >>
      steps:
        - run: &install_yarn
            name: Install Yarn
            command: <<include(scripts/install-yarn)>>
            environment:
              YARN_VERSION: << parameters.version >>
  - when:
      condition: << parameters.windows >>
      steps:
        - run:
            <<: *install_yarn
            command: choco install yarn <<#parameters.version>>--version << parameters.version >></#parameters.version>
  - unless:
      condition: << parameters.windows >>
      steps:
        - run: &check_yarn
            name: Check Yarn Installation
            command: <<include(scripts/check-yarn)>>
            environment:
              YARN_VERSION: << parameters.version >>
  - when:
      condition: << parameters.windows >>
      steps:
        - run:
            <<: *check_yarn
            shell: bash.exe
